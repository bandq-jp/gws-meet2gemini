# バックエンド環境変数設定例
# このファイルをコピーして .env として使用してください

# ===========================================
# ローカル開発環境用設定
# ===========================================

# 環境タイプ（local/production）
ENV=local

# Google 認証設定
SERVICE_ACCOUNT_JSON=service_account.json
GOOGLE_SUBJECT_EMAILS=user1@bandq.jp,user2@bandq.jp

# 収集ソース切り替え（google_docs / notta / both）
MEETING_SOURCE=google_docs

# Notta（共有ドライブExcel）設定
# NOTTA_DRIVE_ID=shared-drive-id
# NOTTA_FOLDER_ID=folder-id
# NOTTA_FOLDER_NAME=Notta Transcripts
# NOTTA_IMPERSONATE_SUBJECT=user1@bandq.jp
# NOTTA_ORGANIZER_EMAIL=notta_shared_drive

# Supabase 設定
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Gemini AI API
GEMINI_API_KEY=your-gemini-api-key
# または
# GOOGLE_API_KEY=your-google-api-key

# Gemini モデル設定
GEMINI_MODEL=gemini-2.5-pro
GEMINI_FALLBACK_MODEL=gemini-2.5-flash
GEMINI_TEMPERATURE=0.1
GEMINI_MAX_TOKENS=20000

# OpenAI / ChatGPT系モデル（ChatKit & Agents SDK 用）
OPENAI_API_KEY=your-openai-api-key
MARKETING_AGENT_MODEL=gpt-5-mini
MARKETING_REASONING_EFFORT=high
MARKETING_ENABLE_WEB_SEARCH=true
MARKETING_ENABLE_CODE_INTERPRETER=true
MARKETING_WORKFLOW_ID=

# ChatKit クライアントトークン署名
MARKETING_CHATKIT_TOKEN_SECRET=change-me-to-random-32bytes
MARKETING_CHATKIT_TOKEN_TTL=900

# ブラウザがアップロード先にアクセスするときのバックエンドURL（本番では必須）
# 例) Cloud Run / Render / FastAPI の公開URL
MARKETING_UPLOAD_BASE_URL=

# 本番フロントエンド(Vercel等)からバックエンドへのアクセス許可（本番では必須）
# 例) https://your-app.vercel.app
CORS_ALLOW_ORIGINS=

# ===========================================
# Google ADK 設定（V2 マーケティングAI）
# ===========================================
# ADKモード有効化（V2 UI = /marketing-v2）
USE_ADK=true
ADK_ORCHESTRATOR_MODEL=gemini-3-flash-preview
ADK_SUB_AGENT_MODEL=gemini-3-flash-preview
# LLM呼び出し回数上限（0 or 負数 = 無制限、デフォルト: 0=無制限）
# 複雑な調査タスクには無制限を推奨、コスト管理には100-500程度を設定
ADK_MAX_LLM_CALLS=0
# 出力トークン上限（Gemini 3 Flash最大: 65536）
# 注意: Gemini 3 Flashは65536設定でも~3-4kで自己終了する既知の問題あり
ADK_MAX_OUTPUT_TOKENS=65536

# ADK メモリサービス設定
MEMORY_SERVICE_TYPE=supabase
MEMORY_AUTO_SAVE=true
MEMORY_PRELOAD_ENABLED=true
MEMORY_MAX_RESULTS=5
MEMORY_EMBEDDING_MODEL=gemini-embedding-001
MEMORY_EMBEDDING_DIMENSIONS=768

# 企業データベース（Google Sheets）
# スプレッドシートID: 【求人提案施策】CLT-hc _企業情報インポート用シート
COMPANY_DB_SPREADSHEET_ID=
# キャッシュTTL（秒）- デフォルト5分
COMPANY_DB_CACHE_TTL=300

# ===========================================
# Local MCP 設定（デフォルト有効）
# ===========================================
# ローカルSTDIOベースのMCPサーバーを使用（デフォルト: true）
# Cloud RunのホステッドMCPより大幅に高速（15-30秒 → 1-2秒）
# リモートMCPを使用したい場合のみ false に設定
USE_LOCAL_MCP=true
LOCAL_MCP_GA4_ENABLED=true
LOCAL_MCP_GSC_ENABLED=true
LOCAL_MCP_META_ADS_ENABLED=true
MCP_CLIENT_TIMEOUT_SECONDS=120

# Meta Ads ローカルMCP認証（長寿命アクセストークン）
# https://developers.facebook.com/tools/accesstoken/ で取得
META_ACCESS_TOKEN=

# ===========================================
# Hosted MCP 設定（リモートCloud Run）
# ===========================================
# USE_LOCAL_MCP=false の場合、または Ahrefs/WordPress で使用
GA4_MCP_SERVER_URL=https:
GA4_MCP_AUTHORIZATION=Bearer your-ga4-server-token
META_ADS_MCP_SERVER_URL=https:
META_ADS_MCP_AUTHORIZATION=Bearer your-meta-ads-token
AHREFS_MCP_SERVER_URL=https
AHREFS_MCP_AUTHORIZATION=Bearer your-ahrefs-token
GSC_MCP_SERVER_URL=https
GSC_MCP_API_KEY=your-gsc-mcp-api-key
# WordPress (hitocareer.com)
WORDPRESS_MCP_SERVER_URL=https://your-wordpress-site/wp-json/mcp/mcp-adapter-default-server
WORDPRESS_MCP_AUTHORIZATION=Basic your-base64-credentials
# WordPress (achievehr.jp)
WORDPRESS_ACHIEVE_MCP_SERVER_URL=https://achievehr.jp/cms/wp-json/mcp/mcp-adapter-default-server
# 例) Basic YWNoaWV2ZWhyLWFkbWluOmprcWtpTkVJaFE3clR1RnlnaFRDeDMyWA==
WORDPRESS_ACHIEVE_MCP_AUTHORIZATION=Basic your-base64-credentials

# CORS 設定（ローカル開発用、本番では社内ドメインのみ設定）
CORS_ALLOW_ORIGINS=http://localhost:3000

# ログレベル
LOG_LEVEL=INFO

# Zoho CRM 設定（オプション）
ZOHO_ACCOUNTS_BASE_URL=https://accounts.zoho.jp
ZOHO_API_BASE_URL=https://www.zohoapis.jp
ZOHO_CLIENT_ID=your-zoho-client-id
ZOHO_CLIENT_SECRET=your-zoho-client-secret
ZOHO_REFRESH_TOKEN=your-zoho-refresh-token
ZOHO_APP_HC_MODULE=CustomModule1

# Cloud Tasks 設定（並列実行用）
GCP_PROJECT=your-gcp-project-id
REGION=asia-northeast1
TASKS_LOCATION=asia-northeast1
TASKS_QUEUE=
TASKS_WORKER_URL=https://your-cloud-run-service-url/api/v1/meetings/collect/worker
TASKS_OIDC_SERVICE_ACCOUNT=cloud-tasks-invoker@your-gcp-project-id.iam.gserviceaccount.com
TASKS_EXPECTED_QUEUE_NAME=

# 自動処理（Docsタイトル x Zoho求職者名の完全一致）
# タイトルから候補者名を抽出する正規表現。名前付きグループ 'name' または最初のキャプチャグループを利用。
# 例: ^MTG\s*-\s*(?P<name>[^\s-]+)\s*-.*$
CANDIDATE_TITLE_REGEX=
# 1回の巡回で処理する最大件数（デフォルト20）
AUTOPROC_MAX_ITEMS=20
# 自動処理ワーカーのURL（未設定時は TASKS_WORKER_URL から自動導出）
TASKS_AUTOPROC_WORKER_URL=https://your-cloud-run-service-url/api/v1/structured/auto-process/worker

# 並列処理設定
AUTOPROC_PARALLEL_WORKERS=5
AUTOPROC_BATCH_SIZE=10

# 監視・アラート設定
AUTOPROC_SUCCESS_RATE_THRESHOLD=0.9
AUTOPROC_QUEUE_ALERT_THRESHOLD=50
AUTOPROC_ERROR_RATE_THRESHOLD=0.05

# スケジュール設定（Cloud Schedulerで使用）
AUTOPROC_BACKLOG_SCHEDULE="0 */2 * * *"
AUTOPROC_REALTIME_SCHEDULE="*/30 10-23 * * *"
AUTOPROC_MAINTENANCE_SCHEDULE="0 1 * * *"

# コスト最適化設定
AUTOPROC_GEMINI_MODEL_SMALL_THRESHOLD=5000
AUTOPROC_GEMINI_MODEL_LARGE_THRESHOLD=15000

# ===========================================
# 本番環境（Cloud Run）用設定
# ===========================================

# 本番環境では以下をCloud Runの環境変数として設定：
# ENV=production
# SERVICE_ACCOUNT_JSON は使用しない（Workload Identity使用）
# GOOGLE_SUBJECT_EMAILS=user1@bandq.jp,user2@bandq.jp
# SUPABASE_URL=https://your-project.supabase.co
# SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
# GEMINI_API_KEY=your-gemini-api-key
# GEMINI_MODEL=gemini-2.5-pro
# GEMINI_FALLBACK_MODEL=gemini-2.5-flash
# GEMINI_TEMPERATURE=0.1
# GEMINI_MAX_TOKENS=20000
# CORS_ALLOW_ORIGINS=https://your-app.vercel.app
# LOG_LEVEL=INFO
# GCP_PROJECT=your-gcp-project-id
# REGION=asia-northeast1
# TASKS_LOCATION=asia-northeast1
# TASKS_QUEUE=
# TASKS_WORKER_URL=https://your-cloud-run-service-url/api/v1/meetings/collect/worker
# TASKS_OIDC_SERVICE_ACCOUNT=cloud-tasks-invoker@your-gcp-project-id.iam.gserviceaccount.com
# TASKS_EXPECTED_QUEUE_NAME=
